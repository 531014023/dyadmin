<!DOCTYPE html>
<html>
<include file="layer:layer_head"/>
<body>
    <!-- 内容主体区域 -->
    <div style="padding:15px;height: 100%;">
        <include file="layer:title"/>
        <hr/>
        <div class="layui-row">
            <div class="layui-col-xs12 layui-form-item">
                <button class="layui-btn layui-btn-normal" type="button" id="addMenu">
                    <i class="iconfont icon-jiajianzujianjiahao"></i>
                    添加菜单
                </button>
            </div>
            <div class="layui-col-xs12" id="pagetable" lay-filter="menu"></div>
        </div>
    </div>
</body>
<include file="layer:layer_js"/>
<!--自己的js代码引入-->
<script type="text/html" id="name">
    {{#  if(d.pid != 0){ }}
    <img src="__ADMIN_PUBLIC__/img/erji.jpg" class="pid" />{{d.name}}
    {{#  } else { }}
    <b>{{d.name}}</b>
    {{#  } }}
</script>
<script type="text/html" id="use_status">
    {{# if(d.use_status == 0){ }}
    <span class="layui-badge layui-bg-orange">尚未启用</span>
    {{#  }  }}
    {{# if(d.use_status == 1){ }}
    <span class="layui-badge layui-bg-blue">已启用</span>
    {{#  }  }}
</script>
<script type="text/html" id="tool">
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="edit">编辑</a>
</script>
<script type="text/javascript">
//    var urlquery = "__ROOT__/admin/Menu/menuList";
    var urlquery = "__ROOT__/admin/Menu/getMenuList";
//    page(urlquery);
    layui.use('table',function () {
        var table = layui.table;
        var cols = [[
            {field:'id',title:'ID',width:'3%'},
            {field:'sort',title:'排序',width:'5%'},
            {field:'name',title:'菜单名称',templet:"#name",edit:true},
            {field:'use_status',title:'启用状态',width:'10%',edit:true,templet:'#use_status'},
            {field:'href',title:'链接'},
            {field:'icon',title:'图标',width:'15%',edit:true,templet:"<div><i class='{{d.icon}}'></i></div>"},
            {field:'action',title:'方法'},
            {fixed: 'right', align:'center', toolbar: '#tool',width:'7%'}
        ]];
        layTable(table,urlquery,cols,5);

        table.on('tool(menu)',function (obj) {
            var data = obj.data; //获得当前行数据
            console.log(data);
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的DOM对象
            if(layEvent == 'edit') {
                updateMenu(table,data.id);
            }
        });

        $("#addMenu").click(function () {
            //每次点击都会重新初始化赋值
            var cancel = false;
            layer.open({
                type: 2,
                title:'添加新菜单',
                area: ['40%', '75%'],
                fixed: false, //不固定
                maxmin: true,
                content: '__ROOT__/admin/menu/addmenu.html',
                end:function () {
                    //只在正常关闭时刷新table,点击关闭时不触发
                    if(cancel){
                        return false;
                    }
                    table.reload("pagetable");
                },
                cancel:function (index) {
                    cancel = true;
                }
            });
        });
    });

    function updateMenu(table,id) {
        var cancel = false;
        layer.open({
            type:2,
            title:"编辑菜单",
            area:['40%','75%'],
            fixed: false, //不固定
            maxmin: true,
            content: '__ROOT__/admin/menu/updateMenu.html?menu_id='+id,
            end:function () {
                if(cancel){
                    return false;
                }
                table.reload("pagetable");
            },
            cancel:function (index) {
                cancel = true;
            }
        });
    }
</script>
</html>